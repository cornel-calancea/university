%include "io.inc"

section .data
    number db "958919", 0
    negative db "negative number", 0

section .text
global CMAIN
CMAIN:
    mov ebp, esp; for correct debugging
    push number;
    call toInt;
    pop ebx;
    PRINT_STRING "EVALUATED NUMBER : ";
    PRINT_DEC 4, eax;
    ret;

toInt:
    push ebp;
    mov ebp, esp;
    
    xor edx, edx; clear edx
    xor eax, eax; clear eax
    xor ecx, ecx;
    mov ebx, 10; multiplication factor
    mov edi, [ebp+8]; edi contains the adress of the string
    cmp byte[edi], 45; see if the first character is '-'
    jnz pushSign; push 0 on stack
    ;sets the sign bit in edx
    mov edx, 1;
    inc edi; //go to the next character
pushSign:
    push edx;
getByte:
    mul ebx;
    mov cl, byte[edi]; transfer the ascii value of the character to ecx
    sub cl, 48; convert to actual number value
    add eax, ecx;
    inc edi;
    cmp byte[edi], 0x00;
    jne getByte;
    pop edx;
    cmp edx, 0; if edx was set, we need to negate the number
    je end;
    neg eax;
end:

    leave;
    ret;